$(function(){s3_gis_locationselector_jQuery_onReady()});
function s3_gis_locationselector_jQuery_onReady(){if("undefined"!=typeof S3.gis.location_id){$("#"+S3.gis.location_id+"__row1").hide();S3.gis.url=S3.Ap.concat("/gis/location");S3.gis.tab&&"search"==S3.gis.tab&&s3_gis_search_tab();try{google&&S3.gis.geocoder?s3_gis_initGeocoder():S3.gis.geocoder&&s3_gis_loadGoogle()}catch(a){}s3_gis_autocompletes();s3_gis_lat_lon_converter();S3.gis.site&&$("#"+S3.gis.site+"_name").blur(function(){if(!$("#gis_location_name").val()){var a=$("#"+S3.gis.site+"_name").val();
$("#gis_location_name").val(a)}});$("#gis_location_L0").change(function(){s3_gis_l0_select()});$("#gis_location_search-btn").click(function(a){s3_gis_search_tab();a.preventDefault()});$("#gis_location_add-btn").click(function(a){s3_gis_add_tab();a.preventDefault()});$("#gis_location_edit-btn").click(function(a){s3_gis_edit_tab();a.preventDefault()});$("#gis_location_view-btn").click(function(a){s3_gis_view_tab();a.preventDefault()});$("#gis_location_expand").click(function(a){$("#gis_location_expand").hasClass("expand")?
(s3_gis_hide_selector(),$("#gis_location_expand").addClass("expanded"),$("#gis_location_expand").removeClass("expand")):(s3_gis_show_tab("add"),$("#gis_location_expand").addClass("expand"),$("#gis_location_expand").removeClass("expanded"));a.preventDefault()});$("#gis_location_search_select-btn").click(function(a){s3_gis_select_search_result();a.preventDefault()});$("form").submit(function(){S3ClearNavigateAwayConfirm();return s3_gis_save_locations()?!0:!1})}}Ext.onReady(function(){s3_gis_locationselector_Ext_onReady()});
function s3_gis_locationselector_Ext_onReady(){var a=Ext.get("gis_location_map-btn");if(a)a.on("click",function(){S3.gis.mapWin.show();var a=$("#gis_location_lat").val(),b=$("#gis_location_lon").val();a&&b||($(".olMapViewport").addClass("crosshair"),S3.gis.pointButton.control.activate())})}function s3_gis_locationselector_activate(){s3_gis_locationselector_jQuery_onReady();s3_gis_locationselector_Ext_onReady()}
function s3_gis_autocompletes(){s3_gis_autocomplete(1);s3_gis_autocomplete(2);s3_gis_autocomplete(3);s3_gis_autocomplete(4);s3_gis_autocomplete(5);s3_gis_autocomplete_search()}
function s3_gis_autocomplete(a){void 0!=$("#gis_location_L"+a+"_ac").val()&&($("#gis_location_L"+a+"_ac").autocomplete({source:s3_gis_ac_set_source(a),delay:500,minLength:2,search:function(c,b){$("#gis_location_L"+a+"_throbber").removeClass("hide").show();$("#gis_location_L"+a).val("");return!0},response:function(c,b,f){$("#gis_location_L"+a+"_throbber").hide();return f},focus:function(c,b){$("#gis_location_L"+a+"_ac").val(b.item.name);return!1},select:function(c,b){$("#gis_location_L"+a+"_ac").val(b.item.name);
$("#gis_location_L"+a).val(b.item.id);"L1"==b.item.level&&b.item.parent&&""==$("#gis_location_L0").val()&&$("#gis_location_L0").val(b.item.parent);$("ul.ui-autocomplete").hide();s3_gis_autocomplete(parseInt(b.item.level.replace("L",""))+1);return!1}}).data("autocomplete")._renderItem=function(a,b){return $("<li></li>").data("item.autocomplete",b).append("<a>"+b.name+"</a>").appendTo(a)})}
function s3_gis_autocomplete_search(){void 0!=$("#gis_location_search_ac").val()&&($("#gis_location_search_ac").autocomplete({source:s3_gis_ac_set_search_source(),delay:500,minLength:2,search:function(a,c){$("#gis_location_search_throbber").removeClass("hide").show();$("#gis_location_search_select-btn").hide();return!0},response:function(a,c,b){$("#gis_location_search_throbber").hide();return b},focus:function(a,c){$("#gis_location_search_ac").val(c.item.name);return!1},select:function(a,c){$("#gis_location_search_ac").val(c.item.name);
$("ul.ui-autocomplete").hide();s3_gis_ac_search_selected(c.item);return!1}}).data("autocomplete")._renderItem=function(a,c){var b=c.name&&c.addr_street?"<a>"+c.name+",  "+c.addr_street.split(",")[0].split("\n")[0]+"</a>":c.name?"<a>"+c.name+"</a>":"<a>"+c.addr_street.split(",")[0].split("\n")[0]+"</a>";return $("<li></li>").data("item.autocomplete",c).append(b).appendTo(a)})}
function s3_gis_ac_set_source(a){var c=$("#gis_location_L"+(a-1)).val(),b;""==c&&1<a&&(b=$("#gis_location_L"+(a-2)).val(),""==b&&2<a&&(b=$("#gis_location_L"+(a-2)).val(),""==b&&3<a&&(b=$("#gis_location_L"+(a-3)).val(),""==b&&4<a&&(b=$("#gis_location_L"+(a-4)).val(),""==b&&5<a&&(b=$("#gis_location_L"+(a-5)).val())))));return c?S3.gis.url+"/search.json?filter=~&field=name&level=L"+a+"&parent="+c:b?S3.gis.url+"/search.json?filter=~&field=name&level=L"+a+"&children="+b:S3.gis.url+"/search.json?filter=~&field=name&level=L"+
a}function s3_gis_ac_set_search_source(){return S3.gis.url+"/search.json?filter=~&field=name&field2=addr_street&level=nullnone"}
function s3_gis_ac_search_selected(a){var c;for(c=0;5>=c;c++)$("#gis_location_L"+c+"_search").val(""),$("#gis_location_L"+c+"_label__row").hide(),$("#gis_location_L"+c+"_search__row").hide();var b=a.path,f=a.parent;if(b){var d=b.slice(0,b.toString().length+1).split("/"),e=d.length-1;if(0==e)$("#gis_location_search_throbber").hide(),$("#gis_location_search_select-btn").removeClass("hide").show();else for(c=0;c<=e;c++)c==e-1?s3_gis_search_hierarchy(d[c],!1,!0):s3_gis_search_hierarchy(d[c],!1,!1)}else f&&
s3_gis_search_hierarchy(f,!0,!0);a.name?($("#gis_location_name_label__row").removeClass("hide").show(),$("#gis_location_name_search").val(a.name),$("#gis_location_name_search__row").removeClass("hide").show()):($("#gis_location_name_label__row").hide(),$("#gis_location_name_search").val(""),$("#gis_location_name_search__row").hide());a.addr_street?($("#gis_location_street_label__row").removeClass("hide").show(),$("#gis_location_street_search").val(a.addr_street),$("#gis_location_street_search__row").removeClass("hide").show()):
($("#gis_location_street_label__row").hide(),$("#gis_location_street_search").val(""),$("#gis_location_street_search__row").hide());a.addr_postcode?($("#gis_location_postcode_label__row").removeClass("hide").show(),$("#gis_location_postcode_search").val(a.addr_postcode),$("#gis_location_postcode_search__row").removeClass("hide").show()):($("#gis_location_postcode_label__row").hide(),$("#gis_location_postcode_search").val(""),$("#gis_location_postcode_search__row").hide());S3.gis.no_latlon||(a.lat?
($("#gis_location_lat_label__row").removeClass("hide").show(),$("#gis_location_lat_search").val(a.lat),$("#gis_location_lat_search__row").removeClass("hide").show()):($("#gis_location_lat_label__row").hide(),$("#gis_location_lat_search").val(""),$("#gis_location_lat_search__row").hide()),a.lon?($("#gis_location_lon_label__row").removeClass("hide").show(),$("#gis_location_lon_search").val(a.lon),$("#gis_location_lon_search__row").removeClass("hide").show()):($("#gis_location_lon_label__row").hide(),
$("#gis_location_lon_search").val(""),$("#gis_location_lon_search__row").hide()));$("body").data("id",a.id);b||f||$("#gis_location_search_select-btn").removeClass("hide").show()}
function s3_gis_lat_lon_converter(){function a(a){return!isNaN(parseFloat(a))&&isFinite(a)}function c(a){return a.parents(".gis_coord_wrap").eq(0)}function b(a){return function(b){a.val(b||"");"undefined"==typeof b&&a.focus()}}function f(a){var b=Math.abs(a),b=60*(b-parseInt(b));if(1E-10>Math.abs(b-Math.round(b)))b=Math.round(b),c=0;else{var c=60*(b-parseInt(b));1E-10>Math.abs(c-Math.round(c))&&(c=Math.round(c))}return{d:parseInt(a),m:parseInt(b),s:c}}function d(c){var d=$(".degrees",c).val()||0,
e=$(".minutes",c).val()||0,k=$(".seconds",c).val()||0,l=b($(".degrees",c)),m=b($(".minutes",c)),n=b($(".seconds",c)),r=b($(".decimal",c));c="gis_location_lat"==$(".decimal",c).attr("id");a(d)?(d=Number(d),Math.abs(d)>(c?90:180)?(alert(h.degrees[c?"lat":"lon"]),l()):a(e)?(e=Math.abs(e),60<e?(alert(h.minutes),m()):a(k)?(k=Math.abs(k),60<=k?(alert(h.seconds),n()):(d=(0>d?-1:1)*(Math.abs(d)+e/60+k/3600),Math.abs(d)>(c?90:180)?alert(h.decimal[c?"lat":"lon"]):(e=f(d),r(""+d),l(e.d||"0"),m(e.m||"0"),n(e.s||
"0")))):(alert(g.seconds),n())):(alert(g.minutes),m())):(alert(g.degrees),l())}function e(b){var c=$(".decimal",b),d=c.val(),e="gis_location_lat"==$(".decimal",b).attr("id");""!=d&&(a(d)?(d=Number(d),Math.abs(d)>(e?90:180)?(alert(h.decimal[e?"lat":"lon"]),c.focus()):(c=f(d),$(".degrees",b).val(c.d||"0"),$(".minutes",b).val(c.m||"0"),$(".seconds",b).val(c.s||"0"))):(alert(g.decimal),c.val("").focus()))}var g=S3.i18n.gis_only_numbers,h=S3.i18n.gis_range_error;$(".gis_coord_dms input").blur(function(){d(c($(this)))}).keypress(function(a){13==
a.which&&a.preventDefault()});$(".gis_coord_decimal input").blur(function(){e(c($(this)))}).keypress(function(a){13==a.which&&a.preventDefault()});$(".gis_coord_switch_dms").click(function(a){$(".gis_coord_dms").show();$(".gis_coord_decimal").hide();$(".gis_coord_wrap").each(function(){e($(this))});a.preventDefault()});$(".gis_coord_switch_decimal").click(function(a){$(".gis_coord_decimal").show();$(".gis_coord_dms").hide();$(".gis_coord_wrap").each(function(){d($(this))});a.preventDefault()});$(".gis_coord_wrap").each(function(){e($(this))})}
function s3_gis_search_hierarchy(a,c,b){$("#gis_location_search_throbber").removeClass("hide").show();$.ajax({async:!0,url:S3.gis.url+"/"+a+".json",dataType:"json",success:function(f){if(f[0].id==a){var d=f[0].name,e=f[0].level;f=f[0].parent;$("body").data(e,a);$("#gis_location_"+e+"_search").val(d);$("#gis_location_"+e+"_label__row").removeClass("hide").show();$("#gis_location_"+e+"_search__row").removeClass("hide").show();c&&f?s3_gis_search_hierarchy(f,!0,!0):b&&($("#gis_location_search_throbber").hide(),
$("#gis_location_search_select-btn").removeClass("hide").show())}}})}function s3_gis_show_level(a){$("#gis_location_L"+a+"_label__row").removeClass("hide").show();$("#gis_location_L"+a+"__row").removeClass("hide").show()}function s3_gis_hide_level(a){$("#gis_location_L"+a+"_label__row").hide();$("#gis_location_L"+a+"__row").hide()}
function s3_gis_l0_select(){var a=$("#gis_location_L0").val(),c=S3.gis.url.replace("gis/location","gis/l0")+"/"+a;$.ajax({async:!0,url:c,dataType:"json",success:function(b){if(b.id==a){S3.gis.country=b.code;for(level=1;6>level;level++){var c="L"+level;if(b[c]){$("#gis_location_"+c+"_label__row label").text(b[c]+":");s3_gis_show_level(level);var d=$("#gis_location_"+c+"__row div.tooltip"),e=d.attr("title").split("|");d.attr("title",b[c]+"|"+e[1]+"|"+e[2]);d.cluetip({activation:"hover",sticky:!1,splitTitle:"|"})}else s3_gis_hide_level(level)}if(!S3.gis.no_map&&
(c=$("#gis_location_lat").val(),d=$("#gis_location_lon").val(),!c&&!d)){var c=b.lon_min,d=b.lat_min,e=b.lon_max,g=b.lat_max;c&&d&&e&&g?s3_gis_zoomMap(c,d,e,g):(c=b.lat,d=b.lon,c&&d&&(b=new OpenLayers.LonLat(d,c),b.transform(S3.gis.proj4326,S3.gis.projection_current),S3.gis.mapWin.rendered?map.setCenter(b):S3.gis.mapPanel.center=b))}}}});$("#gis_location_L1_ac").autocomplete("option","source",s3_gis_ac_set_source(1));$("#gis_location_L2_ac").autocomplete("option","source",s3_gis_ac_set_source(2));
$("#gis_location_L3_ac").autocomplete("option","source",s3_gis_ac_set_source(3));$("#gis_location_L4_ac").autocomplete("option","source",s3_gis_ac_set_source(4));$("#gis_location_L5_ac").autocomplete("option","source",s3_gis_ac_set_source(5))}
function s3_gis_zoomMap(a,c,b,f){S3.gis.mapWin.rendered&&(c=new OpenLayers.LonLat(a,c),f=new OpenLayers.LonLat(b,f),c.transform(S3.gis.proj4326,S3.gis.projection_current),f.transform(S3.gis.proj4326,S3.gis.projection_current),a=c.lon,c=c.lat,b=f.lon,f=f.lat);b=OpenLayers.Bounds.fromArray([a,c,b,f]);a=b.getCenterLonLat();b=map.getZoomForExtent(b,!0);16<b&&(b=16);S3.gis.mapWin.rendered?(map.setCenter(a),map.zoomTo(b)):(a.transform(S3.gis.proj4326,S3.gis.projection_current),S3.gis.mapPanel.center=a,
S3.gis.mapPanel.zoom=b)}function s3_gis_hide_selector(){$(".locselect").hide()}function s3_gis_hide_selector_all(){$("#gis_location_label_row").hide();$(".subheading").hide();s3_gis_hide_selector()}function s3_gis_show_selector(){$("#gis_location_label_row").show();$(".subheading").show();s3_gis_show_tab("add")}
function s3_gis_show_tab(a){$("#gis_location_tabs_row").removeClass("hide").show();if("search"==a)s3_gis_search_tab();else if("add"==a)s3_gis_add_tab();else if("edit"==a)s3_gis_edit_tab();else if("view"==a)s3_gis_view_tab();else return!1}
function s3_gis_search_tab(){$("#gis_location_L0_label__row").hide();$("#gis_location_L0__row").hide();$("#gis_location_name_label__row").hide();$("#gis_location_name__row").hide();$("#gis_location_street_label__row").hide();$("#gis_location_street__row").hide();$("#gis_location_postcode_label__row").hide();$("#gis_location_postcode__row").hide();$("#gis_location_L1_label__row").hide();$("#gis_location_L1__row").hide();$("#gis_location_L2_label__row").hide();$("#gis_location_L2__row").hide();$("#gis_location_L3_label__row").hide();
$("#gis_location_L3__row").hide();$("#gis_location_L4_label__row").hide();$("#gis_location_L4__row").hide();$("#gis_location_L5_label__row").hide();$("#gis_location_L5__row").hide();$("#gis_location_lat_label__row").hide();$("#gis_location_lat__row").hide();$("#gis_location_lon_label__row").hide();$("#gis_location_lon__row").hide();$("#gis_location_search_label__row").removeClass("hide").show();$("#gis_location_search__row").removeClass("hide").show();$("#gis_location_map-btn").html(S3.i18n.gis_view_on_map);
$("#gis_location_map_button_row").hide();$("#gis_loc_add_tab").removeClass("tab_here").addClass("tab_other");$("#gis_loc_search_tab").removeClass("tab_last").addClass("tab_here");$("#gis_location_search_ac").focus()}
function s3_gis_add_tab(){s3_gis_hide_search_fields();$("#gis_location_L0_label__row").show();$("#gis_location_L0__row").show();$("#gis_location_name_label__row").show();$("#gis_location_name__row").show();$("#gis_location_street_label__row").show();$("#gis_location_street__row").show();$("#gis_location_postcode_label__row").show();$("#gis_location_postcode__row").show();$("#gis_location_L1_ac").hasClass("hide")?($("#gis_location_L1_label__row").hide(),$("#gis_location_L1__row").hide()):($("#gis_location_L1_label__row").show(),
$("#gis_location_L1__row").show());$("#gis_location_L2_ac").hasClass("hide")?($("#gis_location_L2_label__row").hide(),$("#gis_location_L2__row").hide()):($("#gis_location_L2_label__row").show(),$("#gis_location_L2__row").show());$("#gis_location_L3_ac").hasClass("hide")?($("#gis_location_L3_label__row").hide(),$("#gis_location_L3__row").hide()):($("#gis_location_L3_label__row").show(),$("#gis_location_L3__row").show());$("#gis_location_L4_ac").hasClass("hide")?($("#gis_location_L4_label__row").hide(),
$("#gis_location_L4__row").hide()):($("#gis_location_L4_label__row").show(),$("#gis_location_L4__row").show());$("#gis_location_L5_ac").hasClass("hide")?($("#gis_location_L5_label__row").hide(),$("#gis_location_L5__row").hide()):($("#gis_location_L5_label__row").show(),$("#gis_location_L5__row").show());S3.gis.no_latlon||($("#gis_location_lat_label__row").show(),$("#gis_location_lat__row").show(),$("#gis_location_lon_label__row").show(),$("#gis_location_lon__row").show());$("#gis_location_map-btn").html(S3.i18n.gis_place_on_map);
$("#gis_location_map_button_row").show();$("#gis_loc_add_tab").removeClass("tab_other").addClass("tab_here");$("#gis_loc_search_tab").removeClass("tab_here").addClass("tab_last");$("#gis_location_search_select-btn").hide()}
function s3_gis_edit_tab(){$("#gis_location_L0").removeAttr("disabled");$("#gis_location_name").removeAttr("disabled");$("#gis_location_street").removeAttr("disabled");$("#gis_location_postcode").removeAttr("disabled");$("#gis_location_lat").removeAttr("disabled");$("#gis_location_lon").removeAttr("disabled");$("#gis_location_L5_ac").removeAttr("disabled");$("#gis_location_L4_ac").removeAttr("disabled");$("#gis_location_L3_ac").removeAttr("disabled");$("#gis_location_L2_ac").removeAttr("disabled");
$("#gis_location_L1_ac").removeAttr("disabled");$("#gis_location_L0_label__row").removeClass("hide").show();$("#gis_location_L0__row").removeClass("hide").show();$("#gis_location_name_label__row").removeClass("hide").show();$("#gis_location_name__row").removeClass("hide").show();$("#gis_location_street_label__row").removeClass("hide").show();$("#gis_location_street__row").removeClass("hide").show();$("#gis_location_postcode_label__row").removeClass("hide").show();$("#gis_location_postcode__row").removeClass("hide").show();
$("#gis_location_L5_ac").hasClass("hide")?($("#gis_location_L5_label__row").hide(),$("#gis_location_L5__row").hide()):($("#gis_location_L5_label__row").removeClass("hide").show(),$("#gis_location_L5__row").removeClass("hide").show());$("#gis_location_L4_ac").hasClass("hide")?($("#gis_location_L4_label__row").hide(),$("#gis_location_L4__row").hide()):($("#gis_location_L4_label__row").removeClass("hide").show(),$("#gis_location_L4__row").removeClass("hide").show());$("#gis_location_L3_ac").hasClass("hide")?
($("#gis_location_L3_label__row").hide(),$("#gis_location_L3__row").hide()):($("#gis_location_L3_label__row").removeClass("hide").show(),$("#gis_location_L3__row").removeClass("hide").show());$("#gis_location_L2_ac").hasClass("hide")?($("#gis_location_L2_label__row").hide(),$("#gis_location_L2__row").hide()):($("#gis_location_L2_label__row").removeClass("hide").show(),$("#gis_location_L2__row").removeClass("hide").show());$("#gis_location_L1_ac").hasClass("hide")?($("#gis_location_L1_label__row").hide(),
$("#gis_location_L1__row").hide()):($("#gis_location_L1_label__row").removeClass("hide").show(),$("#gis_location_L1__row").removeClass("hide").show());S3.gis.no_latlon||($("#gis_location_lat_label__row").removeClass("hide").show(),$("#gis_location_lat__row").removeClass("hide").show(),$("#gis_location_lon_label__row").removeClass("hide").show(),$("#gis_location_lon__row").removeClass("hide").show());$("#gis_location_map-btn").html(S3.i18n.gis_place_on_map);$("#gis_location_map_button_row").show();
$("#gis_loc_edit_tab").removeClass("tab_other").addClass("tab_here");$("#gis_loc_view_tab").removeClass("tab_here").addClass("tab_last")}
function s3_gis_view_tab(){""==$("#gis_location_L0").val()?($("#gis_location_L0_label__row").hide(),$("#gis_location_L0__row").hide()):($("#gis_location_L0").attr("disabled",!0),$("#gis_location_L0__row").show());""==$("#gis_location_name").val()?($("#gis_location_name_label__row").hide(),$("#gis_location_name__row").hide()):($("#gis_location_name").attr("disabled",!0),$("#gis_location_name__row").show());""==$("#gis_location_street").val()?($("#gis_location_street_label__row").hide(),$("#gis_location_street__row").hide()):
($("#gis_location_street").attr("disabled",!0),$("#gis_location_street__row").show());""==$("#gis_location_postcode").val()?($("#gis_location_postcode_label__row").hide(),$("#gis_location_postcode__row").hide()):($("#gis_location_postcode").attr("disabled",!0),$("#gis_location_postcode__row").show());S3.gis.no_latlon||(""==$("#gis_location_lat").val()?($("#gis_location_lat_label__row").hide(),$("#gis_location_lat__row").hide()):($("#gis_location_lat").attr("disabled",!0),$("#gis_location_lat__row").show()),
""==$("#gis_location_lon").val()?($("#gis_location_lon_label__row").hide(),$("#gis_location_lon__row").hide()):($("#gis_location_lon").attr("disabled",!0),$("#gis_location_lon__row").show()));""==$("#gis_location_L5_ac").val()?($("#gis_location_L5_label__row").hide(),$("#gis_location_L5__row").hide()):$("#gis_location_L5_ac").hasClass("hide")||($("#gis_location_L5_ac").attr("disabled",!0),$("#gis_location_L5__row").show());""==$("#gis_location_L4_ac").val()?($("#gis_location_L4_label__row").hide(),
$("#gis_location_L4__row").hide()):$("#gis_location_L4_ac").hasClass("hide")||($("#gis_location_L4_ac").attr("disabled",!0),$("#gis_location_L4__row").show());""==$("#gis_location_L3_ac").val()?($("#gis_location_L3_label__row").hide(),$("#gis_location_L3__row").hide()):$("#gis_location_L3_ac").hasClass("hide")||($("#gis_location_L3_ac").attr("disabled",!0),$("#gis_location_L3__row").show());""==$("#gis_location_L2_ac").val()?($("#gis_location_L2_label__row").hide(),$("#gis_location_L2__row").hide()):
$("#gis_location_L2_ac").hasClass("hide")||($("#gis_location_L2_ac").attr("disabled",!0),$("#gis_location_L2__row").show());""==$("#gis_location_L1_ac").val()?($("#gis_location_L1_label__row").hide(),$("#gis_location_L1__row").hide()):$("#gis_location_L1_ac").hasClass("hide")||($("#gis_location_L1_ac").attr("disabled",!0),$("#gis_location_L1__row").show());$("#gis_location_map-btn").html(S3.i18n.gis_view_on_map);$("#gis_location_map_button_row").show();$("#gis_loc_view_tab").removeClass("tab_other").addClass("tab_here");
$("#gis_loc_edit_tab").removeClass("tab_here").addClass("tab_last")}
function s3_gis_select_search_result(a,c){a=$("body").data("id");$("#"+S3.gis.location_id).val(a);$("#gis_loc_add_tab").hide();$("#gis_loc_search_tab").hide();$("#gis_loc_view_tab").removeClass("hide").show();$("#gis_loc_edit_tab").removeClass("hide").show();s3_gis_hide_search_fields();var b=$("#gis_location_name_search").val();$("#gis_location_name").val(b);b=$("#gis_location_street_search").val();$("#gis_location_street").val(b);b=$("#gis_location_postcode_search").val();$("#gis_location_postcode").val(b);
b=$("#gis_location_lat_search").val();$("#gis_location_lat").val(b);b=$("#gis_location_lon_search").val();$("#gis_location_lon").val(b);b=$("body").data("L0");$("#gis_location_L0").val(b);b=$("body").data("L1");$("#gis_location_L1").val(b);b=$("body").data("L2");$("#gis_location_L2").val(b);b=$("body").data("L3");$("#gis_location_L3").val(b);b=$("body").data("L4");$("#gis_location_L4").val(b);b=$("body").data("L5");$("#gis_location_L5").val(b);b=$("#gis_location_L1_search").val();$("#gis_location_L1_ac").val(b);
b=$("#gis_location_L2_search").val();$("#gis_location_L2_ac").val(b);b=$("#gis_location_L3_search").val();$("#gis_location_L3_ac").val(b);b=$("#gis_location_L4_search").val();$("#gis_location_L4_ac").val(b);b=$("#gis_location_L5_search").val();$("#gis_location_L5_ac").val(b);s3_gis_view_tab()}
function s3_gis_hide_search_fields(){$("#gis_location_search_label__row").hide();$("#gis_location_search__row").hide();$("#gis_location_name_search__row").hide();$("#gis_location_street_search__row").hide();$("#gis_location_postcode_search__row").hide();$("#gis_location_lat_search__row").hide();$("#gis_location_lon_search__row").hide();$("#gis_location_L0_search__row").hide();$("#gis_location_L1_search__row").hide();$("#gis_location_L2_search__row").hide();$("#gis_location_L3_search__row").hide();
$("#gis_location_L4_search__row").hide();$("#gis_location_L5_search__row").hide()}function s3_gis_loadGoogle(){var a=document.createElement("script");a.type="text/javascript";a.src="http://maps.google.com/maps/api/js?v=3.6&sensor=false&callback=s3_gis_initGeocoder";document.body.appendChild(a)}
function s3_gis_initGeocoder(){$("#gis_location_street").blur(function(){s3_gis_geocode()});$("#gis_location_postcode").blur(function(){s3_gis_geocode()});$("#gis_location_L3_ac").blur(function(){s3_gis_geocode()})}
function s3_gis_geocode(){var a=$("#gis_location_lat").val(),c=$("#gis_location_lon").val();if(!a&&!c){if(a=$("#gis_location_street").val())c=a.search(/[A-z]/),a=a.substr(c);(c=$("#gis_location_postcode").val())&&(a+=" "+c);(c=$("#gis_location_L5_ac").val())&&(a+=" "+c);(c=$("#gis_location_L4_ac").val())&&(a+=" "+c);(c=$("#gis_location_L3_ac").val())&&(a+=" "+c);(c=$("#gis_location_L2_ac").val())&&(a+=" "+c);(c=$("#gis_location_L1_ac").val())&&(a+=" "+c);a={address:a};S3.gis.country&&(a.region=S3.gis.country);
(new google.maps.Geocoder).geocode(a,function(a,c){if(c==google.maps.GeocoderStatus.OK){var d=a[0].geometry.location,e=d.lat(),d=d.lng(),e=new OpenLayers.LonLat(d,e);if(d=a[0].geometry.viewport){var e=d.getNorthEast(),g=d.getSouthWest(),d=g.lng(),g=g.lat(),h=e.lng(),e=e.lat();s3_gis_zoomMap(d,g,h,e)}else S3.gis.mapWin.rendered?(e.transform(S3.gis.proj4326,S3.gis.projection_current),map.setCenter(e)):S3.gis.mapPanel.center=e}else s3_debug("Geocode was not successful for the following reason",c)})}}
function s3_gis_save_locations(){$("#"+S3.gis.location_id).val()||$("#"+S3.gis.location_id).val("dummy");if(S3.gis.site){var a="#"+S3.gis.site+"_name",c=$(a).val();if(c)$("#gis_location_name").val()||$("#gis_location_name").val(c);else return void 0==$("#name__error").val()&&$(a).after('<div id="name__error" class="error" style="display: block;">'+S3.i18n.gis_name_required+"</div>"),$(a).focus(),S3.navigate_away_confirm&&S3SetNavigateAwayConfirm(),!1}var a=$("#gis_location_L1").val(),b=$("#gis_location_L2").val(),
f=$("#gis_location_L3").val(),d=$("#gis_location_L4").val(),e=$("#gis_location_L5").val();if(!$("#gis_location_L0").val()){var c=S3.gis.site?"":$("#gis_location_name").val(),g=$("#gis_location_street").val(),h=$("#gis_location_postcode").val(),p=$("#gis_location_lat").val(),q=$("#gis_location_lon").val();if(a||b||f||d||e||c||g||h||p||q)return void 0==$("#country__error").val()&&$("#gis_location_L0").after('<div id="country__error" class="error" style="display: block;">'+S3.i18n.gis_country_required+
"</div>"),$("#gis_location_L0").focus(),S3.navigate_away_confirm&&S3SetNavigateAwayConfirm(),!1}a||(a=$("#gis_location_L1_ac").val())&&$("#gis_location_L1").val(a);b||(b=$("#gis_location_L2_ac").val())&&$("#gis_location_L2").val(b);f||(f=$("#gis_location_L3_ac").val())&&$("#gis_location_L3").val(f);d||(d=$("#gis_location_L4_ac").val())&&$("#gis_location_L4").val(d);e||(e=$("#gis_location_L5_ac").val())&&$("#gis_location_L5").val(e);$("#gis_location_L0").removeAttr("disabled");$("#gis_location_name").removeAttr("disabled");
$("#gis_location_street").removeAttr("disabled");$("#gis_location_postcode").removeAttr("disabled");$("#gis_location_lat").removeAttr("disabled");$("#gis_location_lon").removeAttr("disabled");return!0};
